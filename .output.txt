
 RUN  v3.2.4 C:/Users/oferc/WebstormProjects/NextTrade
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should create new connection when cache is empty
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should create new connection when cache is empty
Connected To Database: test-mongodb://localhost:27017/testdb
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should reuse pending connection promise
Connected To Database: test-mongodb://localhost:27017/testdb
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should connect with correct options
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should connect with correct options
Connected To Database: test-mongodb://localhost:27017/testdb
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should handle concurrent connection attempts correctly
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should handle concurrent connection attempts correctly
Connected To Database: test-mongodb://localhost:27017/testdb
Connected To Database: test-mongodb://localhost:27017/testdb
Connected To Database: test-mongodb://localhost:27017/testdb
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should initialize global cache if not present
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should initialize global cache if not present
Connected To Database: test-mongodb://localhost:27017/testdb
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should handle different MongoDB URI formats
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should handle different MongoDB URI formats
Connected To Database: test-mongodb://localhost:27017/db
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > Global cache behavior > should maintain cache across multiple imports
MongoDB successfully connected
stdout | database/__tests__/mongoose.test.ts > database/mongoose.ts > Global cache behavior > should maintain cache across multiple imports
Connected To Database: test-mongodb://localhost:27017/testdb
 ❯ database/__tests__/mongoose.test.ts (14 tests | 4 failed) 37ms
   ✓ database/mongoose.ts > connectToDatabase > should throw error when MONGODB_URI is not set 9ms
   ✓ database/mongoose.ts > connectToDatabase > should return cached connection if it exists 2ms
   × database/mongoose.ts > connectToDatabase > should create new connection when cache is empty 8ms
     → expected "spy" to be called with arguments: [ …(2) ]
Received:
  1st spy call:
  [
    "mongodb://localhost:27017/testdb",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
   ✓ database/mongoose.ts > connectToDatabase > should reuse pending connection promise 2ms
   ✓ database/mongoose.ts > connectToDatabase > should handle connection errors and reset promise 2ms
   × database/mongoose.ts > connectToDatabase > should connect with correct options 3ms
     → expected "spy" to be called with arguments: [ Any<String>, …(1) ]
Received:
  1st spy call:
  [
-   Any<String>,
+   "mongodb://localhost:27017/testdb",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
   ✓ database/mongoose.ts > connectToDatabase > should handle concurrent connection attempts correctly 2ms
   × database/mongoose.ts > connectToDatabase > should log connection success with environment info 0ms
     → 'process.env' only accepts a configurable, writable, and enumerable data descriptor
   ✓ database/mongoose.ts > connectToDatabase > should initialize global cache if not present 2ms
   × database/mongoose.ts > connectToDatabase > should handle different MongoDB URI formats 2ms
     → expected "spy" to be called with arguments: [ Array(2) ]
Received:
  1st spy call:
  [
    "mongodb://localhost:27017/db",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
   ✓ database/mongoose.ts > connectToDatabase > should handle empty string MONGODB_URI as invalid 1ms
   ✓ database/mongoose.ts > Global cache behavior > should maintain cache across multiple imports 2ms
   ✓ database/mongoose.ts > Error handling edge cases > should handle network timeout errors 1ms
   ✓ database/mongoose.ts > Error handling edge cases > should handle authentication errors 1ms
 ❯ app/(auth)/__tests__/layout.test.tsx (23 tests | 1 failed) 145ms
   ✓ app/(auth)/layout.tsx > Component rendering > should render the main layout structure 24ms
   ✓ app/(auth)/layout.tsx > Component rendering > should render both left and right sections 6ms
   ✓ app/(auth)/layout.tsx > Component rendering > should render children in the left section 5ms
   × app/(auth)/layout.tsx > Component rendering > should render the logo link 26ms
     → expect(element).toHaveClass("auth-logo")
Expected the element to have class:
  auth-logo
Received:
   ✓ app/(auth)/layout.tsx > Component rendering > should render the logo image with correct attributes 10ms
   ✓ app/(auth)/layout.tsx > Component rendering > should render TestimonialRotator component 5ms
   ✓ app/(auth)/layout.tsx > Component rendering > should render dashboard preview image 4ms
   ✓ app/(auth)/layout.tsx > CSS classes - scroll-pt-12 addition > should apply scroll-pt-12 class to left section (NEW CHANGE) 4ms
   ✓ app/(auth)/layout.tsx > CSS classes - scroll-pt-12 addition > should apply all required CSS classes to left section 4ms
   ✓ app/(auth)/layout.tsx > CSS classes - scroll-pt-12 addition > should have exactly three classes on left section 5ms
   ✓ app/(auth)/layout.tsx > CSS classes - scroll-pt-12 addition > should apply correct classes to right section 5ms
   ✓ app/(auth)/layout.tsx > Layout structure > should have proper grid layout for testimonial section 4ms
   ✓ app/(auth)/layout.tsx > Layout structure > should have relative positioning for dashboard preview 4ms
   ✓ app/(auth)/layout.tsx > Layout structure > should have background blur effect element 4ms
   ✓ app/(auth)/layout.tsx > Accessibility > should have descriptive alt text for images 4ms
   ✓ app/(auth)/layout.tsx > Accessibility > should have semantic HTML structure 4ms
   ✓ app/(auth)/layout.tsx > Accessibility > should render clickable logo for navigation 5ms
   ✓ app/(auth)/layout.tsx > Responsive behavior > should have responsive padding classes 4ms
   ✓ app/(auth)/layout.tsx > Responsive behavior > should have responsive padding for right section 3ms
   ✓ app/(auth)/layout.tsx > Image properties > should have proper dimensions for logo 3ms
   ✓ app/(auth)/layout.tsx > Image properties > should have transform and animation classes on dashboard image 4ms
   ✓ app/(auth)/layout.tsx > Integration with child components > should pass intervalMs prop to TestimonialRotator 4ms
   ✓ app/(auth)/layout.tsx > Integration with child components > should render multiple children correctly 4ms
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 5 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
 FAIL  database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should create new connection when cache is empty
AssertionError: expected "spy" to be called with arguments: [ …(2) ]
Received:
  1st spy call:
  [
    "mongodb://localhost:27017/testdb",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
 ❯ database/__tests__/mongoose.test.ts:80:38
     78|
     79|             // Assert
     80|             expect(mongoose.connect).toHaveBeenCalledWith(
       |                                      ^
     81|                 'mongodb://localhost:27017/testdb',
     82|                 {bufferCommands: false}
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯
 FAIL  database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should connect with correct options
AssertionError: expected "spy" to be called with arguments: [ Any<String>, …(1) ]
Received:
  1st spy call:
  [
-   Any<String>,
+   "mongodb://localhost:27017/testdb",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
 ❯ database/__tests__/mongoose.test.ts:139:38
    137|
    138|             // Assert
    139|             expect(mongoose.connect).toHaveBeenCalledWith(
       |                                      ^
    140|                 expect.any(String),
    141|                 {bufferCommands: false}
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯
 FAIL  database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should log connection success with environment info
TypeError: 'process.env' only accepts a configurable, writable, and enumerable data descriptor
 ❯ database/__tests__/mongoose.test.ts:184:20
    182|             // Arrange
    183|             process.env.MONGODB_URI = 'mongodb://localhost:27017/testd…
    184|             Object.defineProperty(process.env, 'NODE_ENV', {value: 'te…
       |                    ^
    185|             const mockMongooseInstance = {connection: 'mock'} as any;
    186|             const consoleLogSpy = vi.spyOn(console, 'log').mockImpleme…
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯
 FAIL  database/__tests__/mongoose.test.ts > database/mongoose.ts > connectToDatabase > should handle different MongoDB URI formats
AssertionError: expected "spy" to be called with arguments: [ Array(2) ]
Received:
  1st spy call:
  [
    "mongodb://localhost:27017/db",
    {
      "bufferCommands": false,
+     "serverSelectionTimeoutMS": 5000,
+     "socketTimeoutMS": 45000,
    },
  ]
Number of calls: 1
 ❯ database/__tests__/mongoose.test.ts:250:42
    248|
    249|                 // Assert
    250|                 expect(mongoose.connect).toHaveBeenCalledWith(
       |                                          ^
    251|                     uri,
    252|                     {bufferCommands: false}
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯
 FAIL  app/(auth)/__tests__/layout.test.tsx > app/(auth)/layout.tsx > Component rendering > should render the logo link
Error: expect(element).toHaveClass("auth-logo")
Expected the element to have class:
  auth-logo
Received:
 ❯ app/(auth)/__tests__/layout.test.tsx:67:30
     65|             const logoLink = screen.getByRole('link');
     66|             expect(logoLink).toHaveAttribute('href', '/');
     67|             expect(logoLink).toHaveClass('auth-logo');
       |                              ^
     68|         });
     69|
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯
 Test Files  2 failed (2)
      Tests  5 failed | 32 passed (37)
   Start at  22:22:31
   Duration  2.75s (transform 118ms, setup 1.16s, collect 118ms, tests 183ms, environment 2.89s, prepare 408ms)